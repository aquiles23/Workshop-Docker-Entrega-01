{"ast":null,"code":"import _taggedTemplateLiteral from \"@babel/runtime/helpers/esm/taggedTemplateLiteral\";\n\nvar _templateObject,\n    _this = this,\n    _jsxFileName = \"/frontend/components/article/ArticleList.tsx\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport styled from \"@emotion/styled\";\nimport { useRouter } from \"next/router\";\nimport React, { useMemo } from \"react\";\nimport useSWR from \"swr\";\nimport ArticlePreview from \"components/article/ArticlePreview\";\nimport ErrorMessage from \"components/common/ErrorMessage\";\nimport LoadingSpinner from \"components/common/LoadingSpinner\";\nimport Maybe from \"components/common/Maybe\";\nimport Pagination from \"components/common/Pagination\";\nimport { usePageState } from \"lib/context/PageContext\";\nimport { usePageCountState, usePageCountDispatch } from \"lib/context/PageCountContext\";\nimport { SERVER_BASE_URL, DEFAULT_LIMIT } from \"lib/utils/constant\";\nimport fetcher from \"lib/utils/fetcher\";\nvar EmptyMessage = styled(\"div\")(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\n  border-top: 1px solid rgba(0, 0, 0, 0.1);\\n  padding: 1.5rem 0;\\n\"])));\n_c = EmptyMessage;\n\nvar ArticleList = function ArticleList() {\n  _s();\n\n  var page = usePageState();\n  var pageCount = usePageCountState();\n  var setPageCount = usePageCountDispatch();\n  var lastIndex = pageCount > 480 ? Math.ceil(pageCount / 20) : Math.ceil(pageCount / 20) - 1;\n  var router = useRouter();\n  var asPath = router.asPath,\n      pathname = router.pathname,\n      query = router.query;\n  var favorite = query.favorite,\n      follow = query.follow,\n      tag = query.tag,\n      pid = query.pid;\n  var isProfilePage = pathname.startsWith(\"/profile\");\n\n  var getFetchURL = function getFetchURL() {\n    switch (true) {\n      case !!tag:\n        return \"\".concat(SERVER_BASE_URL, \"/articles\").concat(asPath, \"&offset=\").concat(page * DEFAULT_LIMIT);\n\n      case isProfilePage && !!favorite:\n        return \"\".concat(SERVER_BASE_URL, \"/articles?favorited=\").concat(encodeURIComponent(String(pid)), \"&offset=\").concat(page * DEFAULT_LIMIT);\n\n      case isProfilePage && !favorite:\n        return \"\".concat(SERVER_BASE_URL, \"/articles?author=\").concat(encodeURIComponent(String(pid)), \"&offset=\").concat(page * DEFAULT_LIMIT);\n\n      case !isProfilePage && !!follow:\n        return \"\".concat(SERVER_BASE_URL, \"/articles/feed?offset=\").concat(page * DEFAULT_LIMIT);\n\n      default:\n        return \"\".concat(SERVER_BASE_URL, \"/articles?offset=\").concat(page * DEFAULT_LIMIT);\n    }\n  };\n\n  var fetchURL = useMemo(function () {\n    return getFetchURL();\n  }, [favorite, page, tag, isProfilePage]);\n\n  var _useSWR = useSWR(fetchURL, fetcher),\n      data = _useSWR.data,\n      error = _useSWR.error;\n\n  if (error) return __jsx(ErrorMessage, {\n    message: \"Cannot load recent articles...\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 21\n    }\n  });\n  if (!data) return __jsx(LoadingSpinner, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 21\n    }\n  });\n  var articles = data.articles,\n      articlesCount = data.articlesCount;\n  setPageCount(articlesCount);\n\n  if ((articles === null || articles === void 0 ? void 0 : articles.length) === 0) {\n    return __jsx(EmptyMessage, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 12\n      }\n    }, \"No articles are here... yet.\");\n  }\n\n  return __jsx(React.Fragment, null, articles === null || articles === void 0 ? void 0 : articles.map(function (article) {\n    return __jsx(ArticlePreview, {\n      key: article.slug,\n      article: article,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 9\n      }\n    });\n  }), __jsx(Maybe, {\n    test: articlesCount && articlesCount > 20,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 7\n    }\n  }, __jsx(Pagination, {\n    total: pageCount,\n    limit: 20,\n    pageCount: 10,\n    currentPage: page,\n    lastIndex: lastIndex,\n    fetchURL: fetchURL,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 9\n    }\n  })));\n};\n\n_s(ArticleList, \"X9h5mm0H49sP3Xso6eQFCZH/i4s=\", false, function () {\n  return [usePageState, usePageCountState, usePageCountDispatch, useRouter, useSWR];\n});\n\n_c2 = ArticleList;\nexport default ArticleList;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"EmptyMessage\");\n$RefreshReg$(_c2, \"ArticleList\");","map":{"version":3,"sources":["/frontend/components/article/ArticleList.tsx"],"names":["styled","useRouter","React","useMemo","useSWR","ArticlePreview","ErrorMessage","LoadingSpinner","Maybe","Pagination","usePageState","usePageCountState","usePageCountDispatch","SERVER_BASE_URL","DEFAULT_LIMIT","fetcher","EmptyMessage","ArticleList","page","pageCount","setPageCount","lastIndex","Math","ceil","router","asPath","pathname","query","favorite","follow","tag","pid","isProfilePage","startsWith","getFetchURL","encodeURIComponent","String","fetchURL","data","error","articles","articlesCount","length","map","article","slug"],"mappings":"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","sourcesContent":["import styled from \"@emotion/styled\";\nimport { useRouter } from \"next/router\";\nimport React, { useMemo } from \"react\";\nimport useSWR from \"swr\";\n\nimport ArticlePreview from \"components/article/ArticlePreview\";\nimport ErrorMessage from \"components/common/ErrorMessage\";\nimport LoadingSpinner from \"components/common/LoadingSpinner\";\nimport Maybe from \"components/common/Maybe\";\nimport Pagination from \"components/common/Pagination\";\nimport { usePageState } from \"lib/context/PageContext\";\nimport {\n  usePageCountState,\n  usePageCountDispatch,\n} from \"lib/context/PageCountContext\";\nimport { SERVER_BASE_URL, DEFAULT_LIMIT } from \"lib/utils/constant\";\nimport fetcher from \"lib/utils/fetcher\";\n\nconst EmptyMessage = styled(\"div\")`\n  border-top: 1px solid rgba(0, 0, 0, 0.1);\n  padding: 1.5rem 0;\n`;\n\nconst ArticleList = () => {\n  const page = usePageState();\n  const pageCount = usePageCountState();\n  const setPageCount = usePageCountDispatch();\n  const lastIndex =\n    pageCount > 480 ? Math.ceil(pageCount / 20) : Math.ceil(pageCount / 20) - 1;\n\n  const router = useRouter();\n  const { asPath, pathname, query } = router;\n  const { favorite, follow, tag, pid } = query;\n  const isProfilePage = pathname.startsWith(`/profile`);\n\n  const getFetchURL = () => {\n    switch (true) {\n      case !!tag:\n        return `${SERVER_BASE_URL}/articles${asPath}&offset=${\n          page * DEFAULT_LIMIT\n        }`;\n      case isProfilePage && !!favorite:\n        return `${SERVER_BASE_URL}/articles?favorited=${encodeURIComponent(\n          String(pid)\n        )}&offset=${page * DEFAULT_LIMIT}`;\n      case isProfilePage && !favorite:\n        return `${SERVER_BASE_URL}/articles?author=${encodeURIComponent(\n          String(pid)\n        )}&offset=${page * DEFAULT_LIMIT}`;\n      case !isProfilePage && !!follow:\n        return `${SERVER_BASE_URL}/articles/feed?offset=${\n          page * DEFAULT_LIMIT\n        }`;\n      default:\n        return `${SERVER_BASE_URL}/articles?offset=${page * DEFAULT_LIMIT}`;\n    }\n  };\n\n  let fetchURL = useMemo(() => getFetchURL(), [\n    favorite,\n    page,\n    tag,\n    isProfilePage,\n  ]);\n\n  const { data, error } = useSWR(fetchURL, fetcher);\n\n  if (error) return <ErrorMessage message=\"Cannot load recent articles...\" />;\n  if (!data) return <LoadingSpinner />;\n\n  const { articles, articlesCount } = data;\n  setPageCount(articlesCount);\n\n  if (articles?.length === 0) {\n    return <EmptyMessage>No articles are here... yet.</EmptyMessage>;\n  }\n\n  return (\n    <>\n      {articles?.map((article) => (\n        <ArticlePreview key={article.slug} article={article} />\n      ))}\n\n      <Maybe test={articlesCount && articlesCount > 20}>\n        <Pagination\n          total={pageCount}\n          limit={20}\n          pageCount={10}\n          currentPage={page}\n          lastIndex={lastIndex}\n          fetchURL={fetchURL}\n        />\n      </Maybe>\n    </>\n  );\n};\n\nexport default ArticleList;\n"]},"metadata":{},"sourceType":"module"}