{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _this = this,\n    _jsxFileName = \"/frontend/pages/profile/[pid].tsx\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useRouter } from \"next/router\";\nimport React from \"react\";\nimport useSWR, { mutate, trigger } from \"swr\";\nimport ArticleList from \"../../components/article/ArticleList\";\nimport CustomImage from \"../../components/common/CustomImage\";\nimport ErrorMessage from \"../../components/common/ErrorMessage\";\nimport Maybe from \"../../components/common/Maybe\";\nimport EditProfileButton from \"../../components/profile/EditProfileButton\";\nimport FollowUserButton from \"../../components/profile/FollowUserButton\";\nimport ProfileTab from \"../../components/profile/ProfileTab\";\nimport UserAPI from \"../../lib/api/user\";\nimport checkLogin from \"../../lib/utils/checkLogin\";\nimport { SERVER_BASE_URL } from \"../../lib/utils/constant\";\nimport fetcher from \"../../lib/utils/fetcher\";\nimport storage from \"../../lib/utils/storage\";\n\nvar Profile = function Profile(_ref) {\n  _s();\n\n  var initialProfile = _ref.initialProfile;\n  var router = useRouter();\n  var pid = router.query.pid;\n\n  var _useSWR = useSWR(\"\".concat(SERVER_BASE_URL, \"/profiles/\").concat(encodeURIComponent(String(pid))), fetcher, {\n    initialData: initialProfile\n  }),\n      fetchedProfile = _useSWR.data,\n      profileError = _useSWR.error;\n\n  if (profileError) return __jsx(ErrorMessage, {\n    message: \"Can't load profile\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 33,\n      columnNumber: 28\n    }\n  });\n\n  var _ref2 = fetchedProfile || initialProfile,\n      profile = _ref2.profile;\n\n  var username = profile.username,\n      bio = profile.bio,\n      image = profile.image,\n      following = profile.following;\n\n  var _useSWR2 = useSWR(\"user\", storage),\n      currentUser = _useSWR2.data;\n\n  var isLoggedIn = checkLogin(currentUser);\n  var isUser = currentUser && username === (currentUser === null || currentUser === void 0 ? void 0 : currentUser.username);\n\n  var handleFollow = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              mutate(\"\".concat(SERVER_BASE_URL, \"/profiles/\").concat(pid), {\n                profile: _objectSpread(_objectSpread({}, profile), {}, {\n                  following: true\n                })\n              }, false);\n              UserAPI.follow(pid);\n              trigger(\"\".concat(SERVER_BASE_URL, \"/profiles/\").concat(pid));\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleFollow() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var handleUnfollow = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              mutate(\"\".concat(SERVER_BASE_URL, \"/profiles/\").concat(pid), {\n                profile: _objectSpread(_objectSpread({}, profile), {}, {\n                  following: true\n                })\n              }, true);\n              UserAPI.unfollow(pid);\n              trigger(\"\".concat(SERVER_BASE_URL, \"/profiles/\").concat(pid));\n\n            case 3:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function handleUnfollow() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(\"div\", {\n    className: \"profile-page\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    className: \"user-info\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: \"container\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: \"row\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: \"col-xs-12 col-md-10 offset-md-1\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 13\n    }\n  }, __jsx(CustomImage, {\n    src: image,\n    alt: \"User's profile image\",\n    className: \"user-img\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 15\n    }\n  }), __jsx(\"h4\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 15\n    }\n  }, username), __jsx(\"p\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 15\n    }\n  }, bio), __jsx(EditProfileButton, {\n    isUser: isUser,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 15\n    }\n  }), __jsx(Maybe, {\n    test: isLoggedIn,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 15\n    }\n  }, __jsx(FollowUserButton, {\n    isUser: isUser,\n    username: username,\n    following: following,\n    follow: handleFollow,\n    unfollow: handleUnfollow,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 17\n    }\n  })))))), __jsx(\"div\", {\n    className: \"container\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: \"row\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: \"col-xs-12 col-md-10 offset-md-1\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: \"articles-toggle\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 13\n    }\n  }, __jsx(ProfileTab, {\n    profile: profile,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 15\n    }\n  })), __jsx(ArticleList, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 13\n    }\n  })))));\n};\n\n_s(Profile, \"/qIubbqRwH1eLj7kiiwMke9JjX4=\", false, function () {\n  return [useRouter, useSWR, useSWR];\n});\n\n_c = Profile;\n\nProfile.getInitialProps = /*#__PURE__*/function () {\n  var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_ref5) {\n    var pid, _yield$UserAPI$get, initialProfile;\n\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            pid = _ref5.query.pid;\n            _context3.next = 3;\n            return UserAPI.get(pid);\n\n          case 3:\n            _yield$UserAPI$get = _context3.sent;\n            initialProfile = _yield$UserAPI$get.data;\n            return _context3.abrupt(\"return\", {\n              initialProfile: initialProfile\n            });\n\n          case 6:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function (_x) {\n    return _ref6.apply(this, arguments);\n  };\n}();\n\nexport default Profile;\n\nvar _c;\n\n$RefreshReg$(_c, \"Profile\");","map":{"version":3,"sources":["/frontend/pages/profile/[pid].tsx"],"names":["useRouter","React","useSWR","mutate","trigger","ArticleList","CustomImage","ErrorMessage","Maybe","EditProfileButton","FollowUserButton","ProfileTab","UserAPI","checkLogin","SERVER_BASE_URL","fetcher","storage","Profile","initialProfile","router","pid","query","encodeURIComponent","String","initialData","fetchedProfile","data","profileError","error","profile","username","bio","image","following","currentUser","isLoggedIn","isUser","handleFollow","follow","handleUnfollow","unfollow","getInitialProps","get"],"mappings":"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","sourcesContent":["import { useRouter } from \"next/router\";\nimport React from \"react\";\nimport useSWR, { mutate, trigger } from \"swr\";\n\nimport ArticleList from \"../../components/article/ArticleList\";\nimport CustomImage from \"../../components/common/CustomImage\";\nimport ErrorMessage from \"../../components/common/ErrorMessage\";\nimport Maybe from \"../../components/common/Maybe\";\nimport EditProfileButton from \"../../components/profile/EditProfileButton\";\nimport FollowUserButton from \"../../components/profile/FollowUserButton\";\nimport ProfileTab from \"../../components/profile/ProfileTab\";\nimport UserAPI from \"../../lib/api/user\";\nimport checkLogin from \"../../lib/utils/checkLogin\";\nimport { SERVER_BASE_URL } from \"../../lib/utils/constant\";\nimport fetcher from \"../../lib/utils/fetcher\";\nimport storage from \"../../lib/utils/storage\";\n\nconst Profile = ({ initialProfile }) => {\n  const router = useRouter();\n  const {\n    query: { pid },\n  } = router;\n\n  const {\n    data: fetchedProfile,\n    error: profileError,\n  } = useSWR(\n    `${SERVER_BASE_URL}/profiles/${encodeURIComponent(String(pid))}`,\n    fetcher,\n    { initialData: initialProfile }\n  );\n\n  if (profileError) return <ErrorMessage message=\"Can't load profile\" />;\n\n  const { profile } = fetchedProfile || initialProfile;\n  const { username, bio, image, following } = profile;\n\n  const { data: currentUser } = useSWR(\"user\", storage);\n  const isLoggedIn = checkLogin(currentUser);\n  const isUser = currentUser && username === currentUser?.username;\n\n  const handleFollow = async () => {\n    mutate(\n      `${SERVER_BASE_URL}/profiles/${pid}`,\n      { profile: { ...profile, following: true } },\n      false\n    );\n    UserAPI.follow(pid);\n    trigger(`${SERVER_BASE_URL}/profiles/${pid}`);\n  };\n\n  const handleUnfollow = async () => {\n    mutate(\n      `${SERVER_BASE_URL}/profiles/${pid}`,\n      { profile: { ...profile, following: true } },\n      true\n    );\n    UserAPI.unfollow(pid);\n    trigger(`${SERVER_BASE_URL}/profiles/${pid}`);\n  };\n\n  return (\n    <div className=\"profile-page\">\n      <div className=\"user-info\">\n        <div className=\"container\">\n          <div className=\"row\">\n            <div className=\"col-xs-12 col-md-10 offset-md-1\">\n              <CustomImage\n                src={image}\n                alt=\"User's profile image\"\n                className=\"user-img\"\n              />\n              <h4>{username}</h4>\n              <p>{bio}</p>\n              <EditProfileButton isUser={isUser} />\n              <Maybe test={isLoggedIn}>\n                <FollowUserButton\n                  isUser={isUser}\n                  username={username}\n                  following={following}\n                  follow={handleFollow}\n                  unfollow={handleUnfollow}\n                />\n              </Maybe>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"container\">\n        <div className=\"row\">\n          <div className=\"col-xs-12 col-md-10 offset-md-1\">\n            <div className=\"articles-toggle\">\n              <ProfileTab profile={profile} />\n            </div>\n            <ArticleList />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nProfile.getInitialProps = async ({ query: { pid } }) => {\n  const { data: initialProfile } = await UserAPI.get(pid);\n  return { initialProfile };\n};\n\nexport default Profile;\n"]},"metadata":{},"sourceType":"module"}